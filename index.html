<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>üìç –ì–æ—Ä–æ–¥—Å–∫–æ–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
    margin: 0;
    font-family: Inter, Arial, sans-serif;
    background: #0f0f0f;
    color: #fff;
}

header {
    padding: 16px;
    font-size: 20px;
    font-weight: 600;
    text-align: center;
    background: #151515;
    border-bottom: 1px solid #222;
}

#loading,
#no-access {
    padding: 40px 20px;
    text-align: center;
}

#no-access button {
    margin-top: 14px;
    padding: 12px 18px;
    font-size: 16px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
}

.btn-subscribe {
    background: #2ea6ff;
    color: #000;
}

.btn-check {
    background: #444;
    color: #fff;
}

#app {
    display: none;
    padding: 12px;
}

.card {
    background: #1b1b1b;
    border-radius: 14px;
    padding: 14px;
    margin-bottom: 12px;
    box-shadow: 0 0 0 1px #262626;
}

.card h3 {
    margin: 0 0 6px;
    font-size: 17px;
}

.card p {
    margin: 0;
    font-size: 14px;
    color: #ccc;
}

.card .actions {
    margin-top: 10px;
    display: flex;
    gap: 10px;
}

.card button {
    flex: 1;
    padding: 10px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    background: #2ea6ff;
    color: #000;
    font-weight: 600;
}
</style>
</head>
<body>

<header>üìç –ì–æ—Ä–æ–¥—Å–∫–æ–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫</header>

<div id="loading">‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞‚Ä¶</div>

<div id="no-access" style="display:none;">
    <h2>üîí –î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω</h2>
    <p>–†–∞–∑–¥–µ–ª –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º –∫–∞–Ω–∞–ª–∞</p>

    <button class="btn-subscribe" onclick="subscribe()">üîî –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</button><br>
    <button class="btn-check" onclick="checkAccess()">üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø</button>
</div>

<div id="app"></div>

<script>
/* =========================
   TELEGRAM INIT
========================= */
if (!window.Telegram || !Telegram.WebApp) {
    document.body.innerHTML = "<h2 style='padding:20px'>‚ùå –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram</h2>";
    throw new Error("Not Telegram");
}

const tg = Telegram.WebApp;
tg.ready();
tg.expand();

/* =========================
   –ù–ê–°–¢–†–û–ô–ö–ò
========================= */
const CHANNEL_URL = "https://t.me/mellstroy_moderators"; // üî¥ –ò–ó–ú–ï–ù–ò
const SERVER_URL  = "http://localhost:3000";             // üî¥ –ò–ó–ú–ï–ù–ò –ü–†–ò –î–ï–ü–õ–û–ï

/* =========================
   –î–ê–ù–ù–´–ï (–¢–ï–°–¢)
========================= */
const DATA = [
    {
        id: "1",
        title: "B√ºrgerb√ºro Karlsruhe",
        description: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞, –¥–æ–∫—É–º–µ–Ω—Ç—ã",
        address: "Kaiserallee 8",
        phone: "+49 721 133333"
    },
    {
        id: "2",
        title: "Arbeitsagentur",
        description: "–†–∞–±–æ—Ç–∞ –∏ –ø–æ—Å–æ–±–∏—è",
        address: "Brauerstra√üe 10",
        phone: "+49 800 4555500"
    }
];

/* =========================
   –ü–†–û–í–ï–†–ö–ê –î–û–°–¢–£–ü–ê
========================= */
function checkAccess() {
    document.getElementById("loading").style.display = "block";
    document.getElementById("no-access").style.display = "none";

    const userId = tg.initDataUnsafe?.user?.id;

    if (!userId) {
        alert("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");
        return;
    }

    fetch(`${SERVER_URL}/check-access?userId=${userId}`)
        .then(r => r.json())
        .then(res => {
            document.getElementById("loading").style.display = "none";

            if (res.access) {
                showApp();
            } else {
                document.getElementById("no-access").style.display = "block";
            }
        })
        .catch(err => {
            console.error(err);
            document.getElementById("loading").style.display = "none";
            alert("‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
        });
}

/* =========================
   –ü–û–ö–ê–ó –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
========================= */
function showApp() {
    const app = document.getElementById("app");
    app.style.display = "block";
    app.innerHTML = "";

    DATA.forEach(item => {
        const card = document.createElement("div");
        card.className = "card";

        card.innerHTML = `
            <h3>${item.title}</h3>
            <p>${item.description}</p>
            <p>üìå ${item.address}</p>
            <p>‚òéÔ∏è ${item.phone}</p>
            <div class="actions">
                <button onclick="share('${item.id}')">üîÅ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
            </div>
        `;

        app.appendChild(card);
    });
}

/* =========================
   –®–ê–†–ò–ù–ì
========================= */
function share(id) {
    const item = DATA.find(x => x.id === id);
    if (!item) return;

    const text = `üìç ${item.title}
${item.description}

üìå ${item.address}
‚òéÔ∏è ${item.phone}

#–∫–∞—Ä–ª—Å—Ä—É—ç #–ø–æ–ª–µ–∑–Ω–æ`;

    const url = `https://t.me/karlsruheinfo_bot/app?startapp=${id}`; // üî¥ –ò–ó–ú–ï–ù–ò

    tg.shareUrl(url, text);
}

/* =========================
   –ü–û–î–ü–ò–°–ö–ê
========================= */
function subscribe() {
    tg.openTelegramLink(CHANNEL_URL);
}

/* =========================
   STARTAPP PARAM
========================= */
const startParam = tg.initDataUnsafe?.start_param;
if (startParam) {
    console.log("–û—Ç–∫—Ä—ã—Ç–æ —á–µ—Ä–µ–∑ startapp:", startParam);
}

/* =========================
   –°–¢–ê–†–¢
========================= */
checkAccess();
</script>

</body>
</html>






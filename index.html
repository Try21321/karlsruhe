<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üìñ –î–æ–≤—ñ–¥–Ω–∏–∫ –ö–∞—Ä–ª—Å—Ä—É–µ ‚Äî Mini App</title>
  <meta name="description" content="–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã: –∂–∏–ª—å—ë, —Ä–∞–±–æ—Ç–∞, –≤—Ä–∞—á–∏, –¥–æ–∫—É–º–µ–Ω—Ç—ã, —É—Å–ª—É–≥–∏. –£–¥–æ–±–Ω—ã–π –ø–æ–∏—Å–∫ –∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ." />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{
      --bg:#0f1115;--card:#161a22;--text:#e6e8ee;--muted:#a2a8b3;
      --primary:#6aa0ff;--accent:#ffc46a;--ok:#2ecc71;--danger:#ff6b6b;
      --radius:16px;--shadow:0 10px 24px rgba(0,0,0,.35)
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--text);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica Neue,Arial,"Apple Color Emoji","Segoe UI Emoji";
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale
    }
    .container{max-width:980px;margin:0 auto;padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;gap:14px;margin-bottom:14px}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:44px;height:44px;border-radius:14px;background:var(--card);display:grid;place-items:center;box-shadow:var(--shadow);font-size:22px}
    .title{font-weight:800;font-size:18px}
    .subtitle{color:var(--muted);font-size:13px}

    .botbar{
      display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:6px 0 14px
    }
    .botname{padding:8px 12px;border-radius:999px;background:#141a26;border:1px solid rgba(255,255,255,.06);color:var(--muted);font-weight:700}
    .tgbtn{background:var(--primary);color:#0b1220;border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer;box-shadow:var(--shadow)}
    .tgbtn:hover{filter:brightness(1.05)}

    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
    .tab{border:1px solid rgba(255,255,255,.08);background:transparent;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}
    .tab.active{background:var(--primary);border-color:var(--primary);color:#0b1220}

    .bar{display:flex;align-items:center;gap:10px;padding:8px 12px;background:#121620;border-radius:12px;margin:10px 0 14px}
    .bar input[type="search"]{flex:1;background:transparent;border:0;color:var(--text);font-size:14px;outline:none}

    .tags{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 14px}
    .chip{font-size:12px;color:var(--muted);background:rgba(255,255,255,.06);padding:5px 9px;border-radius:999px;cursor:pointer;border:1px solid rgba(255,255,255,.06)}
    .chip.active{background:var(--accent);color:#2b1a00;border-color:var(--accent);font-weight:800}

    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media (max-width:920px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:560px){.grid{grid-template-columns:1fr}}

    .card{background:var(--card);border-radius:var(--radius);padding:14px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:8px;border:1px solid rgba(255,255,255,.06)}
    .card h3{margin:0;font-size:16px}
    .meta{color:var(--muted);font-size:12px}
    .actions{display:flex;gap:8px;margin-top:6px;flex-wrap:wrap}
    .btn{border:1px solid rgba(255,255,255,.08);background:transparent;color:var(--text);padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:700}
    .btn.primary{background:var(--primary);color:#0b1220;border-color:var(--primary)}
    .btn.ok{background:var(--ok);color:#06120a;border-color:var(--ok)}
    .btn.danger{background:var(--danger);color:#160606;border-color:var(--danger)}
    .fav{margin-left:auto;background:#1b2436}
    .tagrow{display:flex;gap:6px;flex-wrap:wrap}
    .small{font-size:12px;color:var(--muted)}
    .empty{color:var(--muted);text-align:center;padding:30px 6px}

    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:flex-end;justify-content:center;background:rgba(0,0,0,.5);z-index:40}
    .sheet{width:100%;max-width:720px;background:var(--card);border-radius:16px 16px 0 0;padding:16px;border:1px solid rgba(255,255,255,.08)}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .sheet h3{margin:0 0 4px 0}
    .close{margin-left:auto;background:#192033;border:1px solid rgba(255,255,255,.08);color:var(--muted)}
    .copy{background:#1e2942}
    .sheet .k{color:var(--muted);font-size:12px}
    .sheet .v{font-weight:700}

    .footer{margin:26px 0 40px;text-align:center;color:var(--muted);font-size:12px}
    .link{color:var(--primary);text-decoration:none}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">üó∫Ô∏è</div>
        <div>
          <div class="title">–î–æ–≤—ñ–¥–Ω–∏–∫ –ö–∞—Ä–ª—Å—Ä—É–µ</div>
          <div class="subtitle">–ñ–∏—Ç–ª–æ ‚Ä¢ –†–æ–±–æ—Ç–∞ ‚Ä¢ –õ—ñ–∫–∞—Ä—ñ ‚Ä¢ –î–æ–∫—É–º–µ–Ω—Ç–∏ ‚Ä¢ –ü–æ—Å–ª—É–≥–∏</div>
        </div>
      </div>
      <div class="botbar">
        <div class="botname">@BOT_USERNAME_HERE</div>
        <button class="tgbtn" id="openBot">–í—ñ–¥–∫—Ä–∏—Ç–∏ –≤ Telegram</button>
      </div>
    </header>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="tabs" id="tabs">
      <button class="tab active" data-cat="housing">–ñ–∏—Ç–ª–æ</button>
      <button class="tab" data-cat="jobs">–†–æ–±–æ—Ç–∞</button>
      <button class="tab" data-cat="health">–õ—ñ–∫–∞—Ä—ñ</button>
      <button class="tab" data-cat="docs">–î–æ–∫—É–º–µ–Ω—Ç–∏</button>
      <button class="tab" data-cat="services">–ü–æ—Å–ª—É–≥–∏</button>
      <button class="tab" data-cat="faq">FAQ</button>
      <button class="tab" data-cat="fav">‚≠ê –í–∏–±—Ä–∞–Ω–µ</button>
    </nav>

    <!-- –ü–æ–∏—Å–∫ -->
    <div class="bar">
      <span class="small">üîé</span>
      <input id="search" type="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, —Ç–µ–≥–∞–º, –∞–¥—Ä–µ—Å—É‚Ä¶" />
    </div>

    <!-- –¢–µ–≥–∏ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏) -->
    <div class="tags" id="tags"></div>

    <!-- –°–µ—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ -->
    <section id="grid" class="grid" aria-live="polite"></section>

    <div class="footer">
      –ó—Ä–æ–±–ª–µ–Ω–æ –¥–ª—è –º—ñ–Ω—ñ-–ø—Ä–æ–≥—Ä–∞–º–∏ Telegram. –ü—ñ–¥—Ç—Ä–∏–º–∫–∞: <a class="link" href="https://t.me/BOT_USERNAME_HERE" target="_blank" rel="noopener">–ù–∞–ø–∏—à—ñ—Ç—å –±–æ—Ç—É</a>.
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="sheet">
      <div class="row">
        <h3 id="mTitle">–ù–∞–∑–≤–∞</h3>
        <button class="btn close" id="mClose">–ó–∞–∫—Ä–∏—Ç–∏</button>
      </div>
      <div class="small" id="mCategory">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</div>
      <p id="mDesc" style="margin:10px 0 6px"></p>

      <div class="row small">
        <span class="k">–ê–¥—Ä–µ—Å–∞:</span><span class="v" id="mAddr">‚Äî</span>
      </div>
      <div class="row small">
        <span class="k">–¢–µ–ª–µ—Ñ–æ–Ω:</span><span class="v" id="mPhone">‚Äî</span>
        <button class="btn copy" id="copyPhone">–ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
      </div>
      <div class="row small">
        <span class="k">–ö–æ–Ω—Ç–∞–∫—Ç–∏:</span>
        <a id="mSite" class="btn" href="#" target="_blank" rel="noopener">üåê –°–∞–π—Ç</a>
        <a id="mTG" class="btn" href="#" target="_blank" rel="noopener">Telegram</a>
        <a id="mWA" class="btn" href="#" target="_blank" rel="noopener">WhatsApp</a>
      </div>
      <div class="row small">
        <span class="k">–¢–µ–≥–∏:</span><span class="v" id="mTags">‚Äî</span>
      </div>
      <div class="actions" style="margin-top:12px">
        <a id="mMap" class="btn primary" href="#" target="_blank" rel="noopener">üìç –ü–æ–¥–∏–≤–∏—Ç–∏—Å—å –Ω–∞ –∫–∞—Ä—Ç—ñ</a>
        <button id="mFav" class="btn fav">‚≠ê –í –æ–±—Ä–∞–Ω–µ</button>
        <button id="mShare" class="btn ok">–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è</button>
      </div>
    </div>
  </div>

  <script>
    // ===== –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–∏–º–µ—Ä). –î–æ–±–∞–≤–ª—è–π —Å–≤–æ–∏ –ø—É–Ω–∫—Ç—ã ‚Äî –∏ –≥–æ—Ç–æ–≤–æ. =====
    // –ø–æ–ª—è: id, cat, title, desc, address, phone, site, tg, wa, tags[], mapQuery
    const DATA = [
      // –ñ–ò–õ–¨–Å
      { id:"wg1", cat:"housing", title:"WG-Gesucht",
        desc:"–ü–æ–ø—É–ª—è—Ä–Ω–∞—è –ø–ª–æ—â–∞–¥–∫–∞ –ø–æ–∏—Å–∫–∞ –∫–æ–º–Ω–∞—Ç –∏ –∫–≤–∞—Ä—Ç–∏—Ä –≤ –ì–µ—Ä–º–∞–Ω–∏–∏.",
        address:"–û–Ω–ª–∞–π–Ω", phone:"", site:"https://wg-gesucht.de", tg:"", wa:"",
        tags:["–ø–ª–æ—â–∞–¥–∫–∞","–∞—Ä–µ–Ω–¥–∞","–∫–æ–º–Ω–∞—Ç–∞"], mapQuery:"Berlin" },
      { id:"im1", cat:"housing", title:"Immobilienscout24",
        desc:"–ö—Ä—É–ø–Ω–µ–π—à–∏–π —Å–∞–π—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –∂–∏–ª—å—è: –∫–≤–∞—Ä—Ç–∏—Ä—ã, –¥–æ–º–∞, –∫–æ–º–º–µ—Ä—Ü–∏—è.",
        address:"–û–Ω–ª–∞–π–Ω", phone:"", site:"https://immobilienscout24.de",
        tg:"", wa:"", tags:["–ø–ª–æ—â–∞–¥–∫–∞","–∞—Ä–µ–Ω–¥–∞","–∫–≤–∞—Ä—Ç–∏—Ä–∞"], mapQuery:"Berlin" },
      { id:"miet1", cat:"housing", title:"Mieterverein Berlin",
        desc:"–°–æ—é–∑ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤: –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ –∞—Ä–µ–Ω–¥–µ –∏ –ø—Ä–∞–≤–∞–º –∂–∏–ª—å—Ü–æ–≤.",
        address:"Spichernstr. 1, 10777 Berlin", phone:"+49 30 226260",
        site:"https://mieterverein-berlin.de", tg:"", wa:"",
        tags:["—é—Ä–∏—Å—Ç—ã","–∞—Ä–µ–Ω–¥–∞","–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è"], mapQuery:"Spichernstr. 1, Berlin" },

      // –†–ê–ë–û–¢–ê
      { id:"job1", cat:"jobs", title:"StepStone",
        desc:"–°–∞–π—Ç –≤–∞–∫–∞–Ω—Å–∏–π –ø–æ –≤—Å–µ–π –ì–µ—Ä–º–∞–Ω–∏–∏. –£–¥–æ–±–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–¥–ø–∏—Å–∫–∏.",
        address:"–û–Ω–ª–∞–π–Ω", phone:"", site:"https://stepstone.de", tg:"", wa:"",
        tags:["–≤–∞–∫–∞–Ω—Å–∏–∏","–æ—Ñ–∏—Å","IT"], mapQuery:"Berlin" },
      { id:"job2", cat:"jobs", title:"Indeed",
        desc:"–ë–æ–ª—å—à–∞—è –±–∞–∑–∞ –≤–∞–∫–∞–Ω—Å–∏–π. –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–µ—Ä–≤–æ–π —Ä–∞–±–æ—Ç—ã.",
        address:"–û–Ω–ª–∞–π–Ω", phone:"", site:"https://de.indeed.com", tg:"", wa:"",
        tags:["–≤–∞–∫–∞–Ω—Å–∏–∏","–ª—é–±–æ–π –æ–ø—ã—Ç"], mapQuery:"Berlin" },

      // –í–†–ê–ß–ò
      { id:"med1", cat:"health", title:"Charit√© ‚Äì Universit√§tsmedizin",
        desc:"–û–¥–Ω–∞ –∏–∑ –∫—Ä—É–ø–Ω–µ–π—à–∏—Ö –∫–ª–∏–Ω–∏–∫ –ï–≤—Ä–æ–ø—ã. –ó–∞–ø–∏—Å—å –æ–Ω–ª–∞–π–Ω.",
        address:"Charit√©platz 1, 10117 Berlin", phone:"+49 30 45050",
        site:"https://www.charite.de/en", tg:"", wa:"", tags:["–∫–ª–∏–Ω–∏–∫–∞","—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—Å–∫–∞—è"],
        mapQuery:"Charit√© Berlin" },
      { id:"med2", cat:"health", title:"Apothekenfinder",
        desc:"–ü–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–∏—Ö –∞–ø—Ç–µ–∫ –∏ –¥–µ–∂—É—Ä–Ω—ã—Ö –∞–ø—Ç–µ–∫ –ø–æ –≥–æ—Ä–æ–¥—É.",
        address:"–û–Ω–ª–∞–π–Ω", phone:"", site:"https://www.aponet.de/apotheke/notdienstsuche",
        tg:"", wa:"", tags:["–∞–ø—Ç–µ–∫–∏","–¥–µ–∂—É—Ä–Ω—ã–µ"], mapQuery:"Berlin" },

      // –î–û–ö–£–ú–ï–ù–¢–´
      { id:"amt1", cat:"docs", title:"B√ºrgeramt Termin",
        desc:"–û–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å—å –≤ B√ºrgeramt: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞ (Anmeldung) –∏ –¥—Ä.",
        address:"–†–∞–∑–Ω—ã–µ –∞–¥—Ä–µ—Å–∞", phone:"", site:"https://service.berlin.de/terminvereinbarung",
        tg:"", wa:"", tags:["–∑–∞–ø–∏—Å—å","—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è","anmeldung"], mapQuery:"B√ºrgeramt Berlin" },
      { id:"tr1", cat:"docs", title:"–ü–µ—Ä–µ–≤–æ–¥—á–∏–∫ (—Ä—É—Å/—É–∫—Ä-de)",
        desc:"–°–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ –∑–∞–ø–∏—Å–∏.",
        address:"Friedrichstr. 100, Berlin", phone:"+49 176 11111111",
        site:"", tg:"https://t.me/username", wa:"https://wa.me/4917611111111",
        tags:["–ø–µ—Ä–µ–≤–æ–¥—ã","–Ω–æ—Ç–∞—Ä–∏–∞—Ç"], mapQuery:"Friedrichstr. 100, Berlin" },

      // –£–°–õ–£–ì–ò
      { id:"srv1", cat:"services", title:"–†–µ–º–æ–Ω—Ç –∏ –º–µ–ª–∫–∏–µ —Ä–∞–±–æ—Ç—ã",
        desc:"–°–±–æ—Ä–∫–∞ –º–µ–±–µ–ª–∏, –º–µ–ª–∫–∏–π —Ä–µ–º–æ–Ω—Ç, —ç–ª–µ–∫—Ç—Ä–∏–∫–∞. –ë—ã—Å—Ç—Ä—ã–π –≤—ã–µ–∑–¥.",
        address:"Berlin", phone:"+49 160 22222222", site:"",
        tg:"https://t.me/username2", wa:"https://wa.me/4916022222222",
        tags:["–º–∞—Å—Ç–µ—Ä","—Ä–µ–º–æ–Ω—Ç","—ç–ª–µ–∫—Ç—Ä–∏–∫–∞"], mapQuery:"Berlin" },
      { id:"srv2", cat:"services", title:"–ü–µ—Ä–µ–µ–∑–¥—ã –∏ –ø–µ—Ä–µ–≤–æ–∑–∫–∏",
        desc:"–ì–∞–∑–µ–ª—å/–≤–∞–Ω. –ü–æ–º–æ–∂–µ–º —Å –ø–µ—Ä–µ–µ–∑–¥–æ–º –ø–æ –ë–µ—Ä–ª–∏–Ω—É –∏ –∑–µ–º–ª—è–º.",
        address:"Berlin", phone:"+49 157 33333333", site:"",
        tg:"", wa:"https://wa.me/4915733333333",
        tags:["–≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–∫–∏","–ø–µ—Ä–µ–µ–∑–¥"], mapQuery:"Berlin" },

      // FAQ (–≤–æ–ø—Ä–æ—Å/–æ—Ç–≤–µ—Ç –≤ –æ–ø–∏—Å–∞–Ω–∏–∏)
      { id:"faq1", cat:"faq", title:"–ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å Anmeldung?",
        desc:"1) –ù–∞–π—Ç–∏ –∂–∏–ª—å—ë –∏ –ø–æ–ª—É—á–∏—Ç—å Wohnungsgeberbest√§tigung; 2) –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –≤ B√ºrgeramt; 3) –ø—Ä–∏–π—Ç–∏ —Å –ø–∞—Å–ø–æ—Ä—Ç–æ–º –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏; 4) –ø–æ–ª—É—á–∏—Ç—å Meldebescheinigung.",
        address:"‚Äî", phone:"", site:"https://service.berlin.de/terminvereinbarung",
        tg:"", wa:"", tags:["anmeldung","—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"], mapQuery:"Berlin" },
      { id:"faq2", cat:"faq", title:"–ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å –±–∞–Ω–∫–æ–≤—Å–∫–∏–π —Å—á—ë—Ç?",
        desc:"–û–Ω–ª–∞–π–Ω-–±–∞–Ω–∫–∏ (N26, Vivid) ‚Äî –±—ã—Å—Ç—Ä–æ –∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º. –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –±–∞–Ω–∫–∏ ‚Äî —Å –∑–∞–ø–∏—Å—å—é –≤ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏.",
        address:"‚Äî", phone:"", site:"", tg:"", wa:"", tags:["–±–∞–Ω–∫","—Å—á—ë—Ç"], mapQuery:"Berlin" }
    ];

    const CATS = {
      housing:"–ñ–∏–ª—å—ë", jobs:"–†–∞–±–æ—Ç–∞", health:"–í—Ä–∞—á–∏",
      docs:"–î–æ–∫—É–º–µ–Ω—Ç—ã", services:"–£—Å–ª—É–≥–∏", faq:"FAQ", fav:"–ò–∑–±—Ä–∞–Ω–Ω–æ–µ"
    };

    // ===== DOM =====
    const $tabs = document.getElementById("tabs");
    const $grid = document.getElementById("grid");
    const $tags = document.getElementById("tags");
    const $search = document.getElementById("search");
    const $modal = document.getElementById("modal");
    const $mTitle = document.getElementById("mTitle");
    const $mCategory = document.getElementById("mCategory");
    const $mDesc = document.getElementById("mDesc");
    const $mAddr = document.getElementById("mAddr");
    const $mPhone = document.getElementById("mPhone");
    const $mSite = document.getElementById("mSite");
    const $mTG = document.getElementById("mTG");
    const $mWA = document.getElementById("mWA");
    const $mTags = document.getElementById("mTags");
    const $mMap = document.getElementById("mMap");
    const $mFav = document.getElementById("mFav");
    const $mShare = document.getElementById("mShare");
    const $mClose = document.getElementById("mClose");
    const $openBot = document.getElementById("openBot");

    // ===== STATE =====
    let state = {
      cat:"housing",
      q:"",
      tag:null,
      fav:new Set(JSON.parse(localStorage.getItem("fav")||"[]"))
    };

    // Telegram open
    $openBot.addEventListener("click", ()=>{
      const url = "https://t.me/BOT_USERNAME_HERE";
      if (window.Telegram?.WebApp) {
        Telegram.WebApp.openTelegramLink(url);
      } else {
        window.open(url, "_blank");
      }
    });

    // –¢–µ–≥–∏ –∏–∑ —Ç–µ–∫—É—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    function buildTags(){
      const pool = (state.cat==="fav"
        ? DATA.filter(x=>state.fav.has(x.id))
        : DATA.filter(x=>x.cat===state.cat)
      );
      const set = new Set();
      pool.forEach(x=>x.tags?.forEach(t=>set.add(t)));
      $tags.innerHTML = "";
      if (set.size===0){ return; }
      const all = document.createElement("button");
      all.className = "chip"+(state.tag===null?" active":"");
      all.textContent = "–í—Å–µ —Ç–µ–≥–∏";
      all.onclick = ()=>{ state.tag=null; render(); };
      $tags.appendChild(all);
      [...set].sort().forEach(t=>{
        const b=document.createElement("button");
        b.className="chip"+(state.tag===t?" active":"");
        b.textContent=t;
        b.onclick=()=>{ state.tag = state.tag===t?null:t; render(); };
        $tags.appendChild(b);
      });
    }

    // –ö–∞—Ä—Ç–æ—á–∫–∞
    function card(item){
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <h3>${item.title}</h3>
        <div class="meta">${CATS[item.cat] || ""}</div>
        <div class="small">${item.desc}</div>
        <div class="tagrow">${(item.tags||[]).map(t=>`<span class="chip">${t}</span>`).join("")}</div>
        <div class="actions">
          <button class="btn primary">–û—Ç–∫—Ä—ã—Ç—å</button>
          <button class="btn ${state.fav.has(item.id)?"danger":"fav"}" data-id="${item.id}">
            ${state.fav.has(item.id)?"‚àí –£–¥–∞–ª–∏—Ç—å":"‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ"}
          </button>
        </div>
      `;
      div.querySelector(".btn.primary").onclick = ()=>openModal(item);
      const favBtn = div.querySelector("[data-id]");
      favBtn.onclick = ()=>{
        toggleFav(item.id);
        render();
      };
      return div;
    }

    function toggleFav(id){
      if (state.fav.has(id)) state.fav.delete(id); else state.fav.add(id);
      localStorage.setItem("fav", JSON.stringify([...state.fav]));
    }

    // –†–µ–Ω–¥–µ—Ä —Å–µ—Ç–∫–∏
    function render(){
      document.querySelectorAll(".tab").forEach(t=>{
        t.classList.toggle("active", t.dataset.cat===state.cat);
      });
      buildTags();

      let list = state.cat==="fav"
        ? DATA.filter(x=>state.fav.has(x.id))
        : DATA.filter(x=>x.cat===state.cat);

      const q = state.q.trim().toLowerCase();
      if (q){
        list = list.filter(x=>
          (x.title||"").toLowerCase().includes(q) ||
          (x.desc||"").toLowerCase().includes(q) ||
          (x.address||"").toLowerCase().includes(q) ||
          (x.tags||[]).some(t=>t.toLowerCase().includes(q))
        );
      }
      if (state.tag){
        list = list.filter(x=>x.tags?.includes(state.tag));
      }

      $grid.innerHTML = "";
      if (list.length===0){
        $grid.innerHTML = `<div class="empty">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ò–∑–º–µ–Ω–∏ –∑–∞–ø—Ä–æ—Å –∏–ª–∏ —Ç–µ–≥–∏.</div>`;
        return;
      }
      list.forEach(x=>$grid.appendChild(card(x)));
    }

    // –ú–æ–¥–∞–ª–∫–∞
    function openModal(it){
      $mTitle.textContent = it.title;
      $mCategory.textContent = CATS[it.cat] || "";
      $mDesc.textContent = it.desc || "‚Äî";
      $mAddr.textContent = it.address || "‚Äî";
      $mPhone.textContent = it.phone || "‚Äî";
      $mTags.textContent = (it.tags||[]).join(", ") || "‚Äî";

      // —Å—Å—ã–ª–∫–∏
      setupLink($mSite, it.site, "üåê –°–∞–π—Ç");
      setupLink($mTG, it.tg, "Telegram");
      setupLink($mWA, it.wa, "WhatsApp");

      const mapQuery = encodeURIComponent(it.mapQuery || it.address || "Berlin");
      $mMap.href = `https://www.openstreetmap.org/search?query=${mapQuery}`;

      $mFav.textContent = (state.fav.has(it.id) ? "‚àí –£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ" : "‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ");
      $mFav.onclick = ()=>{ toggleFav(it.id); $mFav.textContent = (state.fav.has(it.id) ? "‚àí –£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ" : "‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ"); render(); };

      $mShare.onclick = async ()=>{
        const url = location.href.split("#")[0];
        const text = `–ü–æ–ª–µ–∑–Ω–æ –≤ –ë–µ—Ä–ª–∏–Ω–µ: ${it.title}\n${it.desc}\n${url}`;
        if (navigator.share){
          try{ await navigator.share({title:it.title,text, url}); }catch{}
        } else {
          await navigator.clipboard.writeText(text);
          alert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞");
        }
      };
      document.getElementById("copyPhone").onclick = async ()=>{
        if (it.phone){ await navigator.clipboard.writeText(it.phone); alert("–¢–µ–ª–µ—Ñ–æ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω"); }
      };

      $modal.style.display = "flex";
    }
    function setupLink(a, href, label){
      if (href){ a.href = href; a.style.display="inline-block"; a.textContent = label; }
      else { a.style.display="none"; }
    }
    function closeModal(){ $modal.style.display="none"; }

    // —Å–æ–±—ã—Ç–∏—è
    $tabs.addEventListener("click", (e)=>{
      const btn = e.target.closest(".tab");
      if (!btn) return;
      state.cat = btn.dataset.cat;
      state.tag = null;
      render();
      // Telegram main button (–ø–æ –∂–µ–ª–∞–Ω–∏—é)
      if (window.Telegram?.WebApp){
        const app = Telegram.WebApp;
        app.MainButton.setText(`–û—Ç–∫—Ä—ã—Ç—å @BOT_USERNAME_HERE`);
        app.MainButton.show();
        app.MainButton.onClick(()=> app.openTelegramLink("https://t.me/BOT_USERNAME_HERE"));
      }
    });
    $search.addEventListener("input", e=>{ state.q = e.target.value; render(); });
    $mClose.addEventListener("click", closeModal);
    $modal.addEventListener("click", (e)=>{ if (e.target===$modal) closeModal(); });

    // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã –∏–∑ Telegram
    (function initTheme(){
      if (window.Telegram?.WebApp){
        const app = Telegram.WebApp;
        app.expand();
        const p = app.themeParams || {};
        const css = document.documentElement.style;
        if (p.bg_color) css.setProperty('--bg', p.bg_color);
        if (p.secondary_bg_color) css.setProperty('--card', p.secondary_bg_color);
        if (p.text_color) css.setProperty('--text', p.text_color);
        if (p.hint_color) css.setProperty('--muted', p.hint_color);
        if (p.button_color) css.setProperty('--primary', p.button_color);
      }
    })();

    // —Å—Ç–∞—Ä—Ç
    render();
  </script>
</body>
</html>


